/*
 * CPOO Server API
 * This is a prototype of CPOO Project's front/back API.
 *
 * The version of the OpenAPI document: 0.0.1
 * Contact: contact@mightycode.fr
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */


package org.openapitools.client.api;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;
import org.openapitools.client.ApiException;
import org.openapitools.client.ApiResponse;
import org.openapitools.client.model.UserDTO;
import org.springframework.http.HttpStatus;

/**
 * API tests for AuthenticationApi
 */
public class AuthenticationApiTest {

    private final AuthenticationApi api = new AuthenticationApi();

    /**
     * @throws ApiException if the Api call fails
     */
    @Test
    public void userSigninPostTest() throws ApiException {
        UserDTO userDTO = new UserDTO().login("user").password("user");
        api.userSigninPost(userDTO);
    }

    /**
     * @throws ApiException if the Api call fails
     */
    @Test
    public void userSignoutPostTest() throws ApiException {

        // Sign in and read the JSESSIONID authentication cookie
        UserDTO userDTO = new UserDTO().login("user").password("user");
        ApiResponse<Void> apiResponse = api.userSigninPostWithHttpInfo(userDTO);
        String setCookieHeader = apiResponse.getHeaders().get("Set-Cookie").get(0);
        String jSessionID = setCookieHeader.split("=")[1].split(";")[0];

        // Set a valid session authentication cookie for subsequent calls
        api.getApiClient().setApiKey(jSessionID);

        // Signing out with a valid session should work
        api.userSignoutPost();

        // Signing out twice should fail with FORBIDDEN
        try {
            api.userSignoutPost();
            Assertions.fail("Signout should fail");
        }
        catch (ApiException e) {
            Assertions.assertEquals(HttpStatus.FORBIDDEN.value(), e.getCode());
        }

        // Sign in again
        api.userSigninPost(userDTO);

        // Signing out with an invalid session should fail with FORBIDDEN
        try {
            api.userSignoutPost();
            Assertions.fail("Signout should fail");
        }
        catch (ApiException e) {
            Assertions.assertEquals(HttpStatus.FORBIDDEN.value(), e.getCode());
        }
    }

    /**
     * @throws ApiException if the Api call fails
     */
    @Test
    public void userSignupPostTest() throws ApiException {
        UserDTO userDTO = new UserDTO().login("test").password("test");
        api.userSignupPost(userDTO);
    }
}
